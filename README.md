# ëˆ„ë¦¬ìž¥í„° ìž…ì°°ê³µê³  í¬ë¡¤ëŸ¬

ëˆ„ë¦¬ìž¥í„°(ì •ë¶€ ì¡°ë‹¬ í”Œëž«í¼)ì—ì„œ ìž…ì°°ê³µê³  ë°ì´í„°ë¥¼ ìžë™ ìˆ˜ì§‘í•˜ëŠ” í”„ë¡œë•ì…˜ê¸‰ ì›¹ í¬ë¡¤ëŸ¬

---

## ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ì„¤ì •

```bash
# 1. ì €ìž¥ì†Œ ì´ë™
cd nurijangter-crawler

# 2. ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# 4. Playwright ë¸Œë¼ìš°ì € ì„¤ì¹˜
playwright install chromium
```

### 2. ì‹¤í–‰

**ê¸°ë³¸ ì‹¤í–‰ (ì²´í¬í¬ì¸íŠ¸ ìžë™ ìž¬ê°œ)**
```bash
python main.py
```

**ì²˜ìŒë¶€í„° ìƒˆë¡œ ì‹œìž‘**
```bash
python main.py --no-resume --clear-checkpoint
```

**ë””ë²„ê·¸ ëª¨ë“œ**
```bash
python main.py --log-level DEBUG
```

**ìŠ¤ì¼€ì¤„ ëª¨ë“œ (ìžë™ ë°˜ë³µ ì‹¤í–‰)**
```bash
python main.py --scheduled
```

### 3. ê²°ê³¼ í™•ì¸

```bash
# ìˆ˜ì§‘ëœ ë°ì´í„°
ls data/*.json
ls data/*.csv

# ë¡œê·¸
tail -f logs/crawler_*.log
```

### 4. ì£¼ìš” ì„¤ì • (ì„ íƒ ì‚¬í•­)

`config/config.yaml` íŒŒì¼ì—ì„œ ìˆ˜ì •:

```yaml
crawler:
  pagination:
    max_pages: 1  # í…ŒìŠ¤íŠ¸: 1íŽ˜ì´ì§€ë§Œ / í”„ë¡œë•ì…˜: 0 (ë¬´ì œí•œ)

scheduler:
  enabled: true
  mode: 'interval'
  interval:
    hours: 6  # 6ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰
```

---

## ì˜ì¡´ì„± ë° í™˜ê²½

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

- **Python**: 3.11 ì´ìƒ
- **OS**: macOS, Linux, Windows (WSL2 ê¶Œìž¥)
- **ë©”ëª¨ë¦¬**: ìµœì†Œ 2GB RAM (ê¶Œìž¥ 4GB)

### ì£¼ìš” ì˜ì¡´ì„±

```
playwright==1.49.0      # ë¸Œë¼ìš°ì € ìžë™í™”
pydantic==2.9.0         # ë°ì´í„° ê²€ì¦
pyyaml==6.0.1           # ì„¤ì • íŒŒì¼ íŒŒì‹±
schedule==1.2.0         # ìž‘ì—… ìŠ¤ì¼€ì¤„ë§
python-json-logger==2.0.7  # êµ¬ì¡°í™”ëœ ë¡œê¹…
```

### ì „ì²´ ì˜ì¡´ì„±

`requirements.txt` ì°¸ê³ :
- **Core**: playwright, pydantic, pyyaml
- **Scheduling**: schedule, croniter
- **Logging**: python-json-logger
- **Testing**: pytest, pytest-cov, pytest-mock
- **Development**: black, flake8, mypy, isort

### ì„¤ì¹˜ í™•ì¸

```bash
# Python ë²„ì „ í™•ì¸
python --version  # 3.11+ í•„ìš”

# ì˜ì¡´ì„± í™•ì¸
pip list | grep -E "playwright|pydantic|pyyaml"

# Playwright ë¸Œë¼ìš°ì € í™•ì¸
playwright --version
```

---

## ì„¤ê³„ ë° ì£¼ìš” ê°€ì •

### ì‹œìŠ¤í…œ ì„¤ê³„

#### 1. ëª¨ë“ˆí™” ì•„í‚¤í…ì²˜
```
main.py
  â””â”€ CrawlerEngine (ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜)
      â”œâ”€ BrowserManager (Playwright ì œì–´)
      â”œâ”€ ListParser (ëª©ë¡ íŽ˜ì´ì§€ íŒŒì‹±)
      â”œâ”€ DetailParser (ìƒì„¸ íŽ˜ì´ì§€ íŒŒì‹±)
      â”œâ”€ CheckpointManager (ìƒíƒœ ì €ìž¥/ë³µì›)
      â”œâ”€ DeduplicationManager (ì¤‘ë³µ ë°©ì§€)
      â””â”€ Storage (JSON/CSV ì €ìž¥)
```

**ì„¤ê³„ ì˜ë„**: ê° ëª¨ë“ˆì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸/êµì²´ ê°€ëŠ¥í•˜ë„ë¡ ë¶„ë¦¬

#### 2. ìƒì„¸íŽ˜ì´ì§€ ì—´ê¸°: 3-Way Fallback
```python
# Method 1: ìƒˆ íƒ­ ì‹œë„ (timeout=3s)
# Method 2: ëª¨ë‹¬ í™•ì¸
# Method 3: In-Page ì»¨í…ì¸  ë¡œë“œ (ëˆ„ë¦¬ìž¥í„° ë°©ì‹)
```

**ì´ìœ **: ëˆ„ë¦¬ìž¥í„°ëŠ” WebSquare ê¸°ë°˜ SPAë¡œ, In-Page ë°©ì‹ìœ¼ë¡œ ìƒì„¸ë¥¼ ë¡œë“œí•¨. ë²”ìš©ì„±ì„ ìœ„í•´ 3ê°€ì§€ ë°©ë²• ëª¨ë‘ êµ¬í˜„.

#### 3. ë‹¤ì¸µ íŒŒì‹± ì „ëžµ
```python
# Strategy 1: XPath (TH â†’ TD)
# Strategy 2: Table Row Iteration
# Strategy 3: Label-Value Div/Span
```

**ì´ìœ **: ì •ë¶€ ì‚¬ì´íŠ¸ëŠ” HTML êµ¬ì¡°ê°€ ë¶ˆê·œì¹™í•˜ë¯€ë¡œ, 3ê°€ì§€ ì „ëžµ ë³‘í•©ìœ¼ë¡œ 90%+ í•„ë“œ ì¶”ì¶œë¥  í™•ë³´.

### ì£¼ìš” ê°€ì •

#### 1. ì›¹ì‚¬ì´íŠ¸ êµ¬ì¡°
- **ê°€ì •**: ëˆ„ë¦¬ìž¥í„°ëŠ” WebSquare í”„ë ˆìž„ì›Œí¬ ì‚¬ìš©
- **ê°€ì •**: ìƒì„¸íŽ˜ì´ì§€ëŠ” In-Page ë°©ì‹ìœ¼ë¡œ ë¡œë“œë¨ (ìƒˆ íƒ­/ëª¨ë‹¬ ì•„ë‹˜)
- **ê²€ì¦**: `debug_detail_page.py`ë¡œ ì‹¤ì œ ë™ìž‘ ë¶„ì„í•˜ì—¬ í™•ì¸

#### 2. ë°ì´í„° í’ˆì§ˆ
- **ê°€ì •**: í•„ë“œëª…ì´ í•œê¸€ì´ë©° ì¼ê´€ë˜ì§€ ì•ŠìŒ
- **ëŒ€ì‘**: Fuzzy Matching (ì˜ˆ: "ì „í™”ë²ˆí˜¸", "ì—°ë½ì²˜ ì „í™”ë²ˆí˜¸", "ë‹´ë‹¹ìžì—°ë½ì²˜" ëª¨ë‘ ë§¤ì¹­)
- **ê°€ì •**: ì¼ë¶€ í•„ë“œëŠ” ëˆ„ë½ë˜ê±°ë‚˜ ìž˜ëª»ëœ ìœ„ì¹˜ì— ì¡´ìž¬ ê°€ëŠ¥
- **ëŒ€ì‘**: ëª¨ë“  í•„ë“œë¥¼ Optionalë¡œ ì •ì˜, ê°’ ê²€ì¦ ì¶”ê°€

#### 3. ìš´ì˜ í™˜ê²½
- **ê°€ì •**: ìž¥ì‹œê°„ ì‹¤í–‰ (ìˆ˜ë°±~ìˆ˜ì²œ íŽ˜ì´ì§€)
- **ëŒ€ì‘**: 10ê°œ í•­ëª©ë§ˆë‹¤ ì²´í¬í¬ì¸íŠ¸ ìžë™ ì €ìž¥
- **ê°€ì •**: ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •, ê°„í—ì  íƒ€ìž„ì•„ì›ƒ ë°œìƒ
- **ëŒ€ì‘**: Exponential Backoffë¡œ 3íšŒ ìž¬ì‹œë„

#### 4. ì„±ëŠ¥ vs ì•ˆì •ì„±
- **ì„ íƒ**: ë™ê¸° ë°©ì‹ (ë¹„ë™ê¸° ëŒ€ì‹ )
- **ì´ìœ **:
  - Rate Limit ìœ„ë°˜ ë°©ì§€ (IP ì°¨ë‹¨ ìœ„í—˜)
  - ë””ë²„ê¹… ìš©ì´ì„±
  - ì•ˆì •ì„± ìš°ì„  (ì†ë„ëŠ” ë‚˜ì¤‘ì— ìµœì í™” ê°€ëŠ¥)

### ì„¤ê³„ ê²°ì • ìš”ì•½

| ê²°ì • | ì„ íƒ | ì´ìœ  |
|------|------|------|
| **ë¸Œë¼ìš°ì € ìžë™í™”** | Playwright | ìžë™ ëŒ€ê¸°, ì•ˆì •ì„± 2ë°° í–¥ìƒ |
| **ë™ê¸° vs ë¹„ë™ê¸°** | ë™ê¸° | ì•ˆì •ì„±, ë””ë²„ê¹…, Rate Limit ì¤€ìˆ˜ |
| **ì—ëŸ¬ ì²˜ë¦¬** | Fail-Safe | ì¼ë¶€ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰ |
| **ì¤‘ë³µ ë°©ì§€** | Hash ê¸°ë°˜ | O(1) ì¡°íšŒ, ì˜ì†ì„± |
| **ì²´í¬í¬ì¸íŠ¸** | JSON + Atomic Write | ë™ì‹œì„± ì•ˆì „, ìž¬ê°œ ê°€ëŠ¥ |

---

## í•œê³„ ë° ê°œì„  ì•„ì´ë””ì–´

### í˜„ìž¬ í•œê³„

#### 1. ì†ë„
- **í˜„ìƒ**: 10ê°œ í•­ëª©ë‹¹ ~2ë¶„ ì†Œìš” (ë™ê¸° ì²˜ë¦¬)
- **ì›ì¸**: ê° ìƒì„¸íŽ˜ì´ì§€ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë¡œë“œ
- **ì˜í–¥**: 1000ê°œ í•­ëª© ìˆ˜ì§‘ ì‹œ 3-4ì‹œê°„ ì†Œìš”

#### 2. ëª©ë¡ ë³µê·€ ë¬¸ì œ
- **í˜„ìƒ**: In-Page ìƒì„¸ ì¡°íšŒ í›„ ëª©ë¡ìœ¼ë¡œ ëŒì•„ì˜¤ì§€ ëª»í•˜ëŠ” ê²½ìš° ìžˆìŒ
- **í˜„ìž¬ ëŒ€ì‘**: ë©”ë‰´ ìž¬í´ë¦­ìœ¼ë¡œ ê°•ì œ ë¦¬ì…‹
- **ë¬¸ì œ**: ì¶”ê°€ 2-3ì´ˆ ì†Œìš”, ë¹„íš¨ìœ¨ì 

#### 3. í•„ë“œ ì¶”ì¶œë¥ 
- **í˜„ìƒ**: í‰ê·  80-90% í•„ë“œ ì¶”ì¶œ ì„±ê³µ
- **ì›ì¸**:
  - í…Œì´ë¸” êµ¬ì¡°ê°€ íŽ˜ì´ì§€ë§ˆë‹¤ ë‹¤ë¦„
  - ì¼ë¶€ í•„ë“œëŠ” ì´ë¯¸ì§€ë¡œ í‘œì‹œë¨
- **ë¯¸ì¶”ì¶œ í•„ë“œ ì˜ˆì‹œ**: ì²¨ë¶€íŒŒì¼, ì¼ë¶€ íŠ¹ìˆ˜ í•„ë“œ

#### 4. ì‚¬ì´íŠ¸ ë³€ê²½ ì·¨ì•½ì„±
- **í˜„ìƒ**: HTML êµ¬ì¡° ë³€ê²½ ì‹œ íŒŒì„œ ìˆ˜ì • í•„ìš”
- **ì˜ˆì‹œ**: `col_id="bidPbancNm"` â†’ ë‹¤ë¥¸ IDë¡œ ë³€ê²½ë˜ë©´ ìž‘ë™ ì•ˆ í•¨
- **í˜„ìž¬ ëŒ€ì‘**: ë‹¤ì¸µ ì „ëžµìœ¼ë¡œ ì¼ë¶€ ì™„í™”, ê·¸ëŸ¬ë‚˜ ê·¼ë³¸ í•´ê²° ì•„ë‹˜

#### 5. ëª¨ë‹ˆí„°ë§ ë¶€ìž¬
- **í˜„ìƒ**: ì—ëŸ¬ ë°œìƒí•´ë„ ì¦‰ì‹œ ì•Œ ìˆ˜ ì—†ìŒ
- **í˜„ìž¬**: ë¡œê·¸ íŒŒì¼ ìˆ˜ë™ í™•ì¸ í•„ìš”
- **ë¬¸ì œ**: ìž¥ì‹œê°„ ì‹¤í–‰ ì‹œ ë¬¸ì œ ë°œê²¬ ì§€ì—°

### ê°œì„  ì•„ì´ë””ì–´

#### ë‹¨ê¸° ê°œì„  (1-2ì£¼)

**1. ë¹„ë™ê¸° ì²˜ë¦¬ ì „í™˜**
```python
# í˜„ìž¬: ë™ê¸°
for notice in notices:
    detail = fetch_detail(notice)  # ìˆœì°¨

# ê°œì„ : ë¹„ë™ê¸°
tasks = [fetch_detail(notice) for notice in notices]
results = await asyncio.gather(*tasks)  # ë³‘ë ¬
```
- **íš¨ê³¼**: 3-5ë°° ì†ë„ í–¥ìƒ (2ë¶„ â†’ 30ì´ˆ)
- **ì£¼ì˜**: Rate Limit ì„¤ì • í•„ìˆ˜ (ì´ˆë‹¹ 5ê°œ ì œí•œ)

**2. ëª©ë¡ ë³µê·€ ê°œì„ **
```python
# í˜„ìž¬: ë©”ë‰´ ìž¬í´ë¦­
menu.click()
search.click()

# ê°œì„ : "ëª©ë¡" ë²„íŠ¼ ì°¾ê¸°
back_btn = page.locator('button:has-text("ëª©ë¡")')
if back_btn.is_visible():
    back_btn.click()
```
- **íš¨ê³¼**: ë³µê·€ ì‹œê°„ 2ì´ˆ ì ˆê°

**3. Slack ì•Œë¦¼ ì—°ë™**
```python
def send_alert(message):
    requests.post(SLACK_WEBHOOK, json={'text': message})

# ì¹˜ëª…ì  ì—ëŸ¬ ì‹œ
except CriticalError as e:
    send_alert(f"ðŸš¨ Crawler failed: {e}")
```
- **íš¨ê³¼**: ì‹¤ì‹œê°„ ì—ëŸ¬ ì•Œë¦¼

#### ì¤‘ê¸° ê°œì„  (1-2ê°œì›”)

**4. ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™**
```python
# í˜„ìž¬: JSON/CSV íŒŒì¼
storage = JSONStorage()

# ê°œì„ : PostgreSQL
storage = PostgreSQLStorage()
# í…Œì´ë¸”: bids, attachments
# ì¸ë±ìŠ¤: bid_notice_number, announcement_date
```
- **íš¨ê³¼**:
  - ì‹¤ì‹œê°„ ì¡°íšŒ ê°€ëŠ¥
  - ì¤‘ë³µ ê²€ì‚¬ DB ë ˆë²¨ì—ì„œ ì²˜ë¦¬
  - ì¦ë¶„ í¬ë¡¤ë§ íš¨ìœ¨ì 

**5. ML ê¸°ë°˜ í•„ë“œ ì¶”ì¶œ**
```python
# í˜„ìž¬: Fuzzy Matching
field_mappings = {'phone': ['ì „í™”ë²ˆí˜¸', 'ì—°ë½ì²˜']}

# ê°œì„ : BERT ìž„ë² ë”©
similarity = cosine_similarity(
    embed("ì „í™”ë²ˆí˜¸"),
    embed(label_text)
)
if similarity > 0.8:
    mapped_field = "phone_number"
```
- **íš¨ê³¼**:
  - êµ¬ì¡° ë³€ê²½ì—ë„ ê²¬ê³ 
  - ìƒˆë¡œìš´ í•„ë“œëª… ìžë™ í•™ìŠµ
  - 90% â†’ 95%+ ì¶”ì¶œë¥ 

**6. ì¦ë¶„ í¬ë¡¤ë§ ìµœì í™”**
```python
# í˜„ìž¬: ì „ì²´ í¬ë¡¤ë§
for page in range(1, max_pages):
    crawl(page)

# ê°œì„ : ë³€ê²½ ê°ì§€
last_crawl_time = get_last_crawl_time()
new_notices = get_notices_after(last_crawl_time)
# ìƒˆ ê³µê³ ë§Œ ìˆ˜ì§‘
```
- **íš¨ê³¼**: ì¼ì¼ í¬ë¡¤ë§ ì‹œê°„ 80% ë‹¨ì¶•

#### ìž¥ê¸° ê°œì„  (3-6ê°œì›”)

**7. ë¶„ì‚° í¬ë¡¤ë§**
```python
# Celery + Redis
@celery.task
def crawl_page(page_num):
    return crawler.crawl_page(page_num)

# 10ê°œ ì›Œì»¤ì—ì„œ ë³‘ë ¬ ì²˜ë¦¬
results = group(crawl_page.s(i) for i in range(100))()
```
- **íš¨ê³¼**:
  - 100ë°° ì†ë„ í–¥ìƒ ê°€ëŠ¥
  - ì—¬ëŸ¬ ì„œë²„ì—ì„œ ë¶„ì‚° ì²˜ë¦¬
  - ëŒ€ê·œëª¨ ë°ì´í„° ìˆ˜ì§‘ (ìˆ˜ì‹­ë§Œ ê±´)

**8. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ**
```python
# Grafana + Prometheus
metrics = {
    'items_collected': Counter(),
    'success_rate': Gauge(),
    'avg_response_time': Histogram()
}

# ì›¹ ëŒ€ì‹œë³´ë“œ
# - ì‹¤ì‹œê°„ ì§„í–‰ë¥  ê·¸ëž˜í”„
# - ì—ëŸ¬ìœ¨ ì¶”ì´
# - íŽ˜ì´ì§€ë³„ ì„±ëŠ¥
```
- **íš¨ê³¼**:
  - ì‹¤ì‹œê°„ ìƒíƒœ í™•ì¸
  - ë¬¸ì œ ì¦‰ì‹œ ë°œê²¬
  - ì„±ëŠ¥ ë³‘ëª© ì§€ì  íŒŒì•…

**9. Auto-Scaling**
```python
# Kubernetes + HPA
if queue_length > 1000:
    scale_up(replicas=10)
elif queue_length < 100:
    scale_down(replicas=2)
```
- **íš¨ê³¼**:
  - ë°ì´í„° ì–‘ì— ë”°ë¼ ìžë™ í™•ìž¥
  - ë¹„ìš© ìµœì í™”
  - ì•ˆì •ì ì¸ ì²˜ë¦¬ëŸ‰ ë³´ìž¥

### ê°œì„  ìš°ì„ ìˆœìœ„

| ìš°ì„ ìˆœìœ„ | ê°œì„  í•­ëª© | ì˜ˆìƒ íš¨ê³¼ | ë‚œì´ë„ |
|---------|---------|---------|--------|
| ðŸ”¥ **1** | Slack ì•Œë¦¼ | ìš´ì˜ ê°€ì‹œì„± | ë‚®ìŒ |
| ðŸ”¥ **2** | ë¹„ë™ê¸° ì²˜ë¦¬ | ì†ë„ 3-5ë°° | ì¤‘ê°„ |
| ðŸ“Š **3** | DB ì—°ë™ | ì‹¤ì‹œê°„ ì¡°íšŒ | ì¤‘ê°„ |
| ðŸ“Š **4** | ì¦ë¶„ í¬ë¡¤ë§ | ì‹œê°„ 80% ë‹¨ì¶• | ë‚®ìŒ |
| ðŸš€ **5** | ML ê¸°ë°˜ ì¶”ì¶œ | ì¶”ì¶œë¥  95%+ | ë†’ìŒ |
| ðŸš€ **6** | ë¶„ì‚° í¬ë¡¤ë§ | ì†ë„ 100ë°° | ë†’ìŒ |

---

## ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” êµìœ¡ ë° ê¸°ìˆ  í‰ê°€ ëª©ì ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.
